(function(){"use strict";var e={782:function(e,t,n){var a=n(726),r=n(992);const o={key:0,class:"fs-5 fw-bold pb-3"},i={key:1,class:"fw-bold pb-3"},l={class:"btn-group",role:"group","aria-label":"Consent options"},s=["id","name","aria-checked"],c=["for"],u=["id","name","aria-checked"],d=["for"];var p=(0,a.pM)({__name:"ConsentQuestion",props:{combinedConsent:{type:Boolean},blueprintId:{}},emits:["consentUpdated"],setup(e,{emit:t}){const{t:n,te:p,locale:f}=(0,r.s9)(),b=e,v=(0,a.KR)(null),g=t;function m(e){g("consentUpdated",e,b.blueprintId),v.value=e}return(e,t)=>((0,a.uX)(),(0,a.CE)(a.FK,null,[e.combinedConsent?((0,a.uX)(),(0,a.CE)("div",o,(0,a.v_)((0,a.R1)(n)("feedback.donation-question")),1)):((0,a.uX)(),(0,a.CE)("div",i,(0,a.v_)((0,a.R1)(n)("feedback.donation-question")),1)),(0,a.Lk)("div",l,[(0,a.Lk)("input",{type:"radio",class:"btn-check",id:"donate-agree-"+e.blueprintId,name:"agreement-"+e.blueprintId,value:!0,"aria-checked":!0===v.value,autocomplete:"off",onChange:t[0]||(t[0]=e=>m(!0)),required:""},null,40,s),(0,a.Lk)("label",{class:(0,a.C4)([{"selected-donate-agree":!0===v.value},"btn btn-light donation-btn shadow-none"]),for:"donate-agree-"+e.blueprintId},(0,a.v_)((0,a.R1)(n)("feedback.donation-agree")),11,c),(0,a.Lk)("input",{type:"radio",class:"btn-check",id:"donate-disagree-"+e.blueprintId,name:"agreement-"+e.blueprintId,value:!1,"aria-checked":!1===v.value,autocomplete:"off",onChange:t[1]||(t[1]=e=>m(!1))},null,40,u),(0,a.Lk)("label",{class:(0,a.C4)([{"selected-donate-disagree":!1===v.value},"btn btn-light donation-btn shadow-none"]),for:"donate-disagree-"+e.blueprintId},(0,a.v_)((0,a.R1)(n)("feedback.donation-disagree")),11,d)])],64))}}),f=n(262);const b=(0,f.A)(p,[["__scopeId","data-v-520690d8"]]);var v=b;const g={SUCCESS:"success",PARTIAL:"partial",FAILED:"failed",PENDING:"pending",NO_DATA:"no data extracted"};function m(e,t){let n;return function(...a){n&&clearTimeout(n);const r=this;n=setTimeout((()=>{e.apply(r,a)}),t)}}const h={class:"pb-2"},E={class:"table table-sm"},y={key:1},x={class:"fs-875 mb-2"},k={for:"data-search",class:"visually-hidden"},I=["placeholder"],C={key:0,class:"fs-875 pb-2"},R={key:1},w=["disabled"],_=["disabled"],L={key:0},S={key:1},D=20;var N=(0,a.pM)({__name:"ExtractionTable",props:{blueprintOutcome:{}},setup(e){const{t:t,te:n,locale:o}=(0,r.s9)(),i=e,l=(0,a.KR)(1),s=(0,a.KR)(!1),c=(0,a.KR)(""),u=(0,a.KR)(""),d=m((e=>{u.value=e.toLowerCase()}),300);(0,a.wB)(c,(e=>{d(e)}));const p=(0,a.EW)((()=>{const e=u.value.toLowerCase();return i.blueprintOutcome.extractedData.filter((t=>{for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const a=t[n];if(String(a).toLowerCase().includes(e))return!0}return!1}))})),f=(0,a.EW)((()=>Math.max(l.value*D-D,0))),b=(0,a.EW)((()=>Math.min(p.value.length,f.value+D))),v=(0,a.EW)((()=>Math.ceil(p.value.length/D)));(0,a.wB)((()=>[v.value]),(()=>{l.value>v.value&&(l.value=v.value),l.value<1&&(l.value=1)}),{immediate:!0,deep:!0});const g=()=>{l.value<v.value&&(l.value+=1)},N=()=>{l.value>1&&(l.value-=1)},O=()=>{s.value=!s.value};return(e,n)=>((0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("div",h,(0,a.v_)((0,a.R1)(t)("extraction-table.donation-info")),1),(0,a.Lk)("div",{class:(0,a.C4)(["table-wrapper fs-875 pb-3",{"table-condensed":!s.value,"table-expanded":s.value}])},[(0,a.Lk)("table",E,[(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.blueprintOutcome.extractedFieldsMap.values(),(e=>((0,a.uX)(),(0,a.CE)("th",{key:e},(0,a.v_)(e),1)))),128))])]),(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(p.value.slice(f.value,b.value),(t=>((0,a.uX)(),(0,a.CE)("tr",{key:t},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.blueprintOutcome.extractedFieldsMap.keys(),(e=>((0,a.uX)(),(0,a.CE)(a.FK,{key:e},[e in t?((0,a.uX)(),(0,a.CE)("td",{key:t},(0,a.v_)(t[e]),1)):((0,a.uX)(),(0,a.CE)("td",y,"–"))],64)))),128))])))),128))])]),(0,a.Lk)("div",x,[(0,a.Lk)("label",k,(0,a.v_)((0,a.R1)(t)("extraction-table.search-entries")),1),(0,a.bo)((0,a.Lk)("input",{id:"data-search",type:"text","onUpdate:modelValue":n[0]||(n[0]=e=>c.value=e),placeholder:(0,a.R1)(t)("extraction-table.search-entries"),"aria-label":"Search data entries"},null,8,I),[[a.Jo,c.value]])]),p.value.length>0?((0,a.uX)(),(0,a.CE)("div",C,(0,a.v_)((0,a.R1)(t)("extraction-table.page-info",{currentPage:l.value,maxPage:v.value}))+" | "+(0,a.v_)((0,a.R1)(t)("extraction-table.entry-info",{lower:f.value+1,upper:Math.min(b.value+1,p.value.length),total:p.value.length})),1)):((0,a.uX)(),(0,a.CE)("div",R,(0,a.v_)((0,a.R1)(t)("extraction-table.all-filtered")),1)),(0,a.Lk)("div",null,[(0,a.Lk)("button",{onClick:N,class:"btn btn-pagination btn-sm me-2",disabled:l.value<=1,"aria-label":"Previous page"},(0,a.v_)((0,a.R1)(t)("extraction-table.previous-page")),9,w),(0,a.Lk)("button",{onClick:g,class:"btn btn-pagination btn-sm me-2",disabled:l.value<v.value,"aria-label":"Next page"},(0,a.v_)((0,a.R1)(t)("extraction-table.next-page")),9,_)])],2),(0,a.Lk)("div",{class:(0,a.C4)(["show-data-control text-center fs-875 mb-3",{"control-expanded":s.value,"control-condensed":!s.value}])},[(0,a.Lk)("a",{class:(0,a.C4)(["expansion-control-btn",{"expansion-control-btn-expanded":s.value,"expansion-control-btn-condensed":!s.value}]),onClick:O},[s.value?s.value?((0,a.uX)(),(0,a.CE)("span",S,(0,a.v_)((0,a.R1)(t)("extraction-table.hide-data")),1)):(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("span",L,(0,a.v_)((0,a.R1)(t)("extraction-table.show-data")),1))],2)],2)],64))}});const O=(0,f.A)(N,[["__scopeId","data-v-4bb1242c"]]);var T=O;const A={class:"d-flex flex-column align-items-start pt-3 pb-3 blueprint-row"},F={class:"d-flex flex-row align-items-start pb-1"},P={class:"status-icon"},U={class:"fw-bold"},M={class:"d-flex flex-row align-items-start w-100 overflow-hidden"},X={class:"status-icon opacity-0"},K={class:"d-flex flex-column w-100"},G={key:0},W={class:"pb-3"},j={key:0,class:"pt-3 pb-1"},z={class:"pb-2"},B={key:0},V={role:"button","aria-expanded":"false",id:"error-details-summary"},$={role:"region","aria-labelledby":"error-details-summary"},Z={key:0};var H=(0,a.pM)({__name:"ExtractionItem",props:{blueprint:{},extractionState:{},extractionMessage:{},extractionErrorText:{},extractionOutcome:{},hasDetailErrors:{type:Boolean},errors:{},combinedConsent:{type:Boolean}},emits:["consentUpdated"],setup(e,{emit:t}){const{t:n,te:o,locale:i}=(0,r.s9)(),l=e,s=t,c={[g.SUCCESS]:"bi bi-file-earmark-check-fill text-success",[g.FAILED]:"bi bi-file-earmark-x-fill text-danger",[g.NO_DATA]:"bi bi-file-earmark-x-fill text-grey",[g.PENDING]:"bi bi-file-earmark-fill text-grey",[g.PARTIAL]:""},u=(0,a.EW)((()=>l.extractionState?c[l.extractionState]:c[g.PENDING])),d=(0,a.EW)((()=>l.extractionState==g.PENDING)),p=(0,a.EW)((()=>l.extractionState==g.SUCCESS)),f=(0,a.EW)((()=>l.extractionState==g.NO_DATA)),b=(0,a.EW)((()=>l.extractionState==g.FAILED)),m=(e,t)=>{s("consentUpdated",e,t)};return(e,t)=>((0,a.uX)(),(0,a.CE)("div",A,[(0,a.Lk)("div",F,[(0,a.Lk)("div",P,[(0,a.Lk)("i",{class:(0,a.C4)(u.value)},null,2)]),(0,a.Lk)("div",U,(0,a.v_)(e.blueprint.name),1)]),(0,a.Lk)("div",M,[(0,a.Lk)("div",X,[(0,a.Lk)("i",{class:(0,a.C4)(u.value)},null,2)]),(0,a.Lk)("div",K,[d.value?((0,a.uX)(),(0,a.CE)("div",G,(0,a.v_)(e.blueprint.description),1)):p.value?((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[(0,a.Lk)("div",W,(0,a.v_)(e.blueprint.description),1),(0,a.Lk)("div",null,[(0,a.bF)(T,{"blueprint-outcome":e.extractionOutcome},null,8,["blueprint-outcome"])]),!1===e.combinedConsent?((0,a.uX)(),(0,a.CE)("div",j,[(0,a.bF)(v,{"combined-consent":e.combinedConsent,"blueprint-id":e.blueprint.id,onConsentUpdated:m},null,8,["combined-consent","blueprint-id"])])):(0,a.Q3)("",!0)],64)):f.value?((0,a.uX)(),(0,a.CE)(a.FK,{key:2},[(0,a.Lk)("div",z,(0,a.v_)(e.blueprint.description),1),(0,a.Lk)("div",null,(0,a.v_)((0,a.R1)(n)(`${e.extractionMessage}`)),1)],64)):b.value?((0,a.uX)(),(0,a.CE)(a.FK,{key:3},[(0,a.Lk)("div",null,(0,a.v_)((0,a.R1)(n)(`${e.extractionMessage}`))+" "+(0,a.v_)(e.extractionErrorText),1),e.hasDetailErrors?((0,a.uX)(),(0,a.CE)("div",B,[(0,a.Lk)("details",null,[(0,a.Lk)("summary",V,(0,a.v_)((0,a.R1)(n)("feedback.show-error-details")),1),(0,a.Lk)("div",$,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.errors,((e,t)=>((0,a.uX)(),(0,a.CE)(a.FK,{key:t},[(0,a.R1)(o)(`${e.i18nDetail}-detail`)?((0,a.uX)(),(0,a.CE)("p",Z,(0,a.v_)((0,a.R1)(n)(`${e.i18nDetail}-detail`,e.context)),1)):(0,a.Q3)("",!0)],64)))),128))])])])):(0,a.Q3)("",!0)],64)):(0,a.Q3)("",!0)])])]))}});const Q=(0,f.A)(H,[["__scopeId","data-v-5837fb97"]]);var J=Q;const q={class:"pb-3 d-flex align-items-center"},Y={class:"section-heading"};var ee=(0,a.pM)({__name:"ExtractionOverview",props:{uploaderState:{},extractionState:{},blueprints:{},blueprintExtractionStates:{},blueprintOutcomeMap:{},combinedConsent:{type:Boolean}},emits:["consentUpdated"],setup(e,{emit:t}){const{t:n,te:o,locale:i}=(0,r.s9)(),l=e,s=t,c=(0,a.Kh)(u());function u(){return Object.fromEntries(l.blueprints.map((e=>{const t=l.blueprintExtractionStates[e.id]?.state,n=l.blueprintExtractionStates[e.id]?.i18nState,a=l.blueprintOutcomeMap[e.id]?.processingErrors??[],r=a.some((e=>o(`${e.i18nDetail}-detail`))),i=p(a);return[e.id,{state:t,msg:n,errors:a,anyDetails:r,errorText:i}]})))}function d(){const e=u();Object.keys(c).forEach((e=>delete c[e])),Object.assign(c,e)}function p(e){let t="";if(0===e.length)return"";if(1===e.length)return n(`${e[0].i18nDetail}`,e[0].context);for(let a=0;a<e.length;a++)t+=n(`${e[a].i18nDetail}`,e[a].context).toLowerCase(),a<e.length-2?t+=", ":a===e.length-2&&(t+=", and ");return t}(0,a.sV)((()=>{d()})),(0,a.wB)((()=>l.uploaderState),(()=>{l.extractionState!=g.PENDING&&d()}),{immediate:!0,deep:!0});const f=(e,t)=>{s("consentUpdated",e,t)},b=(0,a.EW)((()=>l.extractionState===g.PENDING?n("feedback.intro-extraction-pending"):n("feedback.intro-extraction-complete")));return(e,t)=>((0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("div",q,[t[0]||(t[0]=(0,a.Lk)("span",{class:"section-icon"},[(0,a.Lk)("i",{class:"bi bi-file-earmark-text"})],-1)),(0,a.Lk)("span",Y,(0,a.v_)(b.value),1)]),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(l.blueprints,(t=>((0,a.uX)(),(0,a.Wv)(J,{key:t.id,blueprint:t,"extraction-state":c[t.id]?.state,"extraction-message":c[t.id]?.msg,"extraction-error-text":c[t.id]?.errorText,"extraction-outcome":e.blueprintOutcomeMap[t.id],"has-detail-errors":c[t.id].anyDetails,errors:c[t.id]?.errors||[],"combined-consent":e.combinedConsent,onConsentUpdated:f},null,8,["blueprint","extraction-state","extraction-message","extraction-error-text","extraction-outcome","has-detail-errors","errors","combined-consent"])))),128))],64))}});const te=ee;var ne=te;const ae={IDLE:"idle",PROCESSING:"processing",DONE:"done"},re={class:"d-lg-flex flex-row align-items-center justify-content-between"},oe={class:"pe-5 pb-0 d-flex align-items-center"},ie={class:"section-icon"},le={key:0,class:"bi bi-check-square fs-2 pe-3 text-success"},se={key:1,class:"bi bi-upload fs-2 pe-3"},ce={class:"section-heading"},ue={class:"flex-grow-1"},de={class:"mb-0"},pe={key:0,class:"ps-2 fw-bold fs-6"},fe={key:1,class:"ps-2 fw-bold fs-6"},be=["accept"],ve={key:1,class:"d-flex align-items-center justify-content-center p-4"},ge={class:"mb-0"},me={key:2,class:"p-4"},he={key:0},Ee={class:"fs-5 fw-bold text-success"},ye={key:1},xe={class:"fs-5 fw-bold color-red"},ke={key:0},Ie={class:"pt-2"},Ce={key:2},Re={class:"fs-5 fw-bold"},we={key:0,class:"pt-2 w-100 text-center"};var _e=(0,a.pM)({__name:"FileDrop",props:{expectsZip:{type:Boolean},uploaderState:{},extractionState:{},generalErrors:{}},emits:["fileDropped"],setup(e,{emit:t}){const{t:n,locale:o}=(0,r.s9)(),i=e,l=t,s=(0,a.KR)(!1),c=(0,a.KR)(!1),u=(0,a.KR)(""),d=(0,a.lW)(i,"extractionState"),p=(0,a.KR)("bg-lightgrey");(0,a.sV)((()=>{b()}));const f={[g.SUCCESS]:"border-success",[g.PARTIAL]:"border-success",[g.FAILED]:"border-failed",[g.NO_DATA]:"border-no-data",[g.PENDING]:"bg-lightgrey"};function b(){i.expectsZip?u.value=".zip,application/zip,application/x-zip-compressed,multipart/x-zip":u.value="application/json,text/csv,.csv,.json"}function v(e){e.preventDefault(),s.value=!1;const t=e.dataTransfer?.files;t?.[0]&&(c.value=!1,l("fileDropped",t[0]))}function m(e){const t=e.target,n=t.files;if(!n||0===n.length)return;const a=n[0];c.value=!1,l("fileDropped",a)}function h(){c.value=!0,p.value="bg-lightgrey"}(0,a.wB)(d,(e=>{p.value=f[e]}));const E=(0,a.EW)((()=>i.uploaderState===ae.IDLE||c.value)),y=(0,a.EW)((()=>i.uploaderState===ae.PROCESSING)),x=(0,a.EW)((()=>i.uploaderState===ae.DONE)),k=(0,a.EW)((()=>i.uploaderState===ae.DONE&&i.extractionState!==g.FAILED&&!c.value)),I=(0,a.EW)((()=>i.extractionState===g.SUCCESS||i.extractionState===g.PARTIAL)),C=(0,a.EW)((()=>i.extractionState===g.FAILED)),R=(0,a.EW)((()=>i.extractionState===g.NO_DATA));return(e,t)=>((0,a.uX)(),(0,a.CE)("div",re,[(0,a.Lk)("div",oe,[(0,a.Lk)("span",ie,[["success","partial"].includes(i.extractionState)?((0,a.uX)(),(0,a.CE)("i",le)):((0,a.uX)(),(0,a.CE)("i",se))]),(0,a.Lk)("span",ce,(0,a.v_)((0,a.R1)(n)("file-drop.heading")),1)]),(0,a.Lk)("div",ue,[(0,a.Lk)("div",{class:(0,a.C4)(["border rounded text-center position-relative bg-lightgrey",p.value])},[E.value?((0,a.uX)(),(0,a.CE)("div",{key:0,class:(0,a.C4)(["p-4",{"dropzone-hover":s.value}]),onDragover:t[0]||(t[0]=(0,a.D$)((e=>s.value=!0),["prevent"])),onDragleave:t[1]||(t[1]=(0,a.D$)((e=>s.value=!1),["prevent"])),onDrop:v,onClick:t[2]||(t[2]=t=>e.$refs.fileInput.click()),style:{cursor:"pointer"}},[(0,a.Lk)("p",de,[t[3]||(t[3]=(0,a.Lk)("i",{id:"ul-modal-info-icon",class:"bi bi-upload fs-5 pe-3"},null,-1)),s.value?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("span",pe,(0,a.v_)((0,a.R1)(n)("file-drop.selection-prompt")),1)),s.value?((0,a.uX)(),(0,a.CE)("span",fe,(0,a.v_)((0,a.R1)(n)("file-drop.release-to-select")),1)):(0,a.Q3)("",!0)]),(0,a.Lk)("input",{ref:"fileInput",type:"file",class:"d-none",accept:u.value,onChange:m},null,40,be)],34)):y.value?((0,a.uX)(),(0,a.CE)("div",ve,[t[4]||(t[4]=(0,a.Lk)("span",{class:"spinner-border float-right me-3",role:"status"},[(0,a.Lk)("span",{class:"sr-only"})],-1)),(0,a.Lk)("p",ge,(0,a.v_)((0,a.R1)(n)("file-drop.file-is-being-processed")),1)])):x.value?((0,a.uX)(),(0,a.CE)("div",me,[I.value?((0,a.uX)(),(0,a.CE)("div",he,[(0,a.Lk)("p",Ee,[t[5]||(t[5]=(0,a.Lk)("i",{class:"bi bi-check-circle pe-3"},null,-1)),(0,a.eW)((0,a.v_)((0,a.R1)(n)("file-drop.processing-success")),1)]),(0,a.eW)(" "+(0,a.v_)((0,a.R1)(n)("extraction-state.file.success")),1)])):C.value?((0,a.uX)(),(0,a.CE)("div",ye,[(0,a.Lk)("p",xe,(0,a.v_)((0,a.R1)(n)("file-drop.processing-failed")),1),i.generalErrors.length?((0,a.uX)(),(0,a.CE)("div",ke,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.generalErrors,((e,t)=>((0,a.uX)(),(0,a.CE)("p",{key:t,class:"pt-3 color-darkred"},(0,a.v_)((0,a.R1)(n)(e.i18nDetail,e.context)),1)))),128))])):(0,a.Q3)("",!0),(0,a.Lk)("p",Ie,[(0,a.eW)((0,a.v_)((0,a.R1)(n)("file-drop.retry-hint"))+" ",1),(0,a.Lk)("a",{class:"btn re-try-btn fs-6",onClick:h},(0,a.v_)((0,a.R1)(n)("file-drop.choose-different-file")),1)])])):R.value?((0,a.uX)(),(0,a.CE)("div",Ce,[(0,a.Lk)("p",Re,(0,a.v_)((0,a.R1)(n)("file-drop.processing-complete")),1),(0,a.eW)(" "+(0,a.v_)((0,a.R1)(n)("extraction-state.file.no-data-extracted")),1)])):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0)],2),k.value?((0,a.uX)(),(0,a.CE)("div",we,[(0,a.Lk)("a",{class:"btn re-try-btn fs-6",onClick:h},(0,a.v_)((0,a.R1)(n)("file-drop.choose-different-file")),1)])):(0,a.Q3)("",!0)])]))}});const Le=(0,f.A)(_e,[["__scopeId","data-v-6b88704e"]]);var Se=Le;const De={class:"d-flex align-items-center"},Ne={class:"section-heading"},Oe={class:"d-flex flex-row align-items-center carousel"},Te={class:"control-container"},Ae={class:"carousel-inner"},Fe={class:"control-container"},Pe={class:"text-center"},Ue=["aria-label","onClick"];var Me=(0,a.pM)({__name:"Instructions",props:{instructions:{},componentId:{}},setup(e){const{t:t,locale:n}=(0,r.s9)(),o=e,i=(0,a.KR)(0);function l(){i.value>0&&i.value--}function s(){i.value<o.instructions.length-1&&i.value++}function c(e){i.value=e}const u=(0,a.EW)((()=>i.value>0)),d=(0,a.EW)((()=>i.value<o.instructions.length-1)),p=(0,a.EW)((()=>o.instructions[i.value].text));return(e,n)=>((0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("div",De,[n[0]||(n[0]=(0,a.Lk)("span",{class:"section-icon"},[(0,a.Lk)("i",{class:"bi bi-list-ol"})],-1)),(0,a.Lk)("span",Ne,(0,a.v_)((0,a.R1)(t)("instructions.heading")),1)]),(0,a.Lk)("div",Oe,[(0,a.Lk)("div",Te,[u.value?((0,a.uX)(),(0,a.CE)("a",{key:0,onClick:l,class:(0,a.C4)(["control-btn control-prev",{"btn-disabled":0===i.value}])},n[1]||(n[1]=[(0,a.Lk)("i",{class:"bi bi-caret-left-fill"},null,-1),(0,a.Lk)("span",{class:"visually-hidden"},"Previous",-1)]),2)):(0,a.Q3)("",!0)]),(0,a.Lk)("div",Ae,[(0,a.bF)(a.eB,{name:"fade",mode:"out-in"},{default:(0,a.k6)((()=>[((0,a.uX)(),(0,a.Wv)((0,a.$y)("div"),{key:i.value,class:"carousel-item active",innerHTML:p.value},null,8,["innerHTML"]))])),_:1})]),(0,a.Lk)("div",Fe,[d.value?((0,a.uX)(),(0,a.CE)("a",{key:0,onClick:s,class:(0,a.C4)(["control-btn control-next",{"btn-disabled":i.value===o.instructions.length-1}])},n[2]||(n[2]=[(0,a.Lk)("i",{class:"bi bi-caret-right-fill"},null,-1),(0,a.Lk)("span",{class:"visually-hidden"},"Next",-1)]),2)):(0,a.Q3)("",!0)])]),(0,a.Lk)("div",Pe,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(o.instructions,((e,t)=>((0,a.uX)(),(0,a.CE)("button",{key:t,type:"button",class:(0,a.C4)(["step-indicator",{"active step-indicator-active":t===i.value}]),"aria-label":`Slide ${t+1}`,onClick:e=>c(t)},null,10,Ue)))),128))])],64))}});const Xe=(0,f.A)(Me,[["__scopeId","data-v-5a0b4e47"]]);var Ke=Xe;function Ge(e,t){const n=(0,a.KR)(r());function r(){const t={};for(const n of e)t[n.id]=null;return t}const o=(e,a)=>{if(t)for(const t of Object.keys(n.value))n.value[t]=e;else{if(null===a)return void console.warn("Attempted to update consent for null blueprintId in individual consent mode");if(!(a in n.value))return void console.warn(`Attempted to update consent for unknown blueprint ID: ${a}`);n.value[a]=e}};return{blueprintConsentMap:n,updateConsent:o}}const We={INFO:"info",WARN:"warn",CRITICAL:"critical"},je={FILE:"file",BLUEPRINT:"blueprint"},ze={ZIP_HANDLING:"ZIP handling error",FILE_PROCESSING:"File processing error",BLUEPRINT_SPECIFICATION:"Blueprint specification error",EXTRACTION:"Extraction error"};function Be(e,t){const n=(0,a.KR)(g.PENDING),r=(0,a.KR)([]),o=(0,a.KR)({});function i(){for(const e of Object.keys(t))o.value[e]={state:g.PENDING,i18nState:null,errorsToDisplay:[]}}function l(){n.value=g.PENDING,r.value=[],o.value={}}function s(){l(),c(),u(),d()}function c(){for(const t of e)t.level===We.CRITICAL&&r.value.push(t)}function u(){for(const[e,n]of Object.entries(t))o.value[e]=f(n)}function d(){if(r.value.length>0)return void(n.value=g.FAILED);const e=Object.keys(o.value).length,t=b(g.SUCCESS),a=b(g.NO_DATA),i=b(g.FAILED);n.value=p(e,t,a,i)}function p(e,t,n,a){return t===e?g.SUCCESS:n===e?g.NO_DATA:a===e?g.FAILED:g.PARTIAL}function f(e){let t=g.PENDING,n=null;const a=e.processingErrors.filter((e=>e.level===We.CRITICAL));a.length>0&&(t=g.FAILED,n="extraction-state.blueprint.failed");const r=e.extractedData.length,o=e.extractionStats,i=o.nRowsTotal>0?o.nRowsMissingField/o.nRowsTotal:0,l=o.nRowsTotal>0?o.nRowsFilteredOut/o.nRowsTotal:0;return 0===r&&0===a.length?(t=g.NO_DATA,n=1===i?"extraction-state.blueprint.all-missing-fields":1===l?"extraction-state.blueprint.all-filtered-out":"extraction-state.blueprint.no-data-extracted"):0===a.length&&(t=g.SUCCESS,n="extraction-state.blueprint.success"),{state:t,i18nState:n,errorsToDisplay:a}}function b(e){return Object.values(o.value).filter((t=>t.state===e)).length}return i(),{extractionState:n,generalErrorsToDisplay:r,blueprintExtractionStates:o,getExtractionState:s}}class Ve{constructor(e){this.blueprintId=e.id,this.extractedData=[],this.extractedFieldsMap=new Map,this.extractionStats={nRowsMissingField:0,nRowsFilteredOut:0,nRowsTotal:0,noKeyMatches:{}},this.extractionRuleLog=this.initializeExtractionRuleLog(e.extraction_rules),this.processingErrors=[]}initializeExtractionRuleLog(e){return Object.fromEntries(e.map((e=>[e.id,0])))}incrementExtractionRuleCount(e){this.extractionStats.nRowsFilteredOut+=1,this.extractionRuleLog[e.id]+=1}registerNoKeyMatch(e,t){this.extractionStats.noKeyMatches[e]||(this.extractionStats.noKeyMatches[e]={});const n=JSON.stringify([...t].sort());this.extractionStats.noKeyMatches[e][n]||(this.extractionStats.noKeyMatches[e][n]=0),this.extractionStats.noKeyMatches[e][n]+=1}registerError(e,t){this.processingErrors.push({type:e.type,category:e.category,scope:e.scope,i18nDetail:e.i18nDetail,level:e.level,context:{...e.context,...t,blueprintId:this.blueprintId}})}mapExtractedField(e,t){this.extractedFieldsMap.has(e)||this.extractedFieldsMap.set(e,t)}}var $e=n(710),Ze=n.n($e);const He={INVALID_ZIP:{type:"INVALID_ZIP",category:ze.ZIP_HANDLING,scope:je.FILE,i18nDetail:"errors.invalid-zip",level:We.CRITICAL,context:{fileType:"[invalid file type]"}},ZIP_READ_FAIL:{type:"ZIP_READ_FAIL",category:ze.ZIP_HANDLING,scope:je.FILE,i18nDetail:"errors.zip-read-fail",level:We.CRITICAL,context:{}},INVALID_REGEX:{type:"INVALID_REGEX",category:ze.BLUEPRINT_SPECIFICATION,scope:je.BLUEPRINT,i18nDetail:"errors.invalid-regex",level:We.CRITICAL,context:{blueprintId:"[blueprint ID]"}},INVALID_RULE_REGEX:{type:"INVALID_RULE_REGEX",category:ze.EXTRACTION,scope:je.BLUEPRINT,i18nDetail:"errors.invalid-rule-regex",level:We.WARN,context:{blueprintId:"[blueprint ID]",ruleId:"[rule ID]",ruleRegex:"[rule regex]"}},NO_FILE_MATCH:{type:"NO_FILE_MATCH",category:ze.EXTRACTION,scope:je.BLUEPRINT,i18nDetail:"errors.no-file-match",level:We.CRITICAL,context:{blueprintId:"[blueprint ID]",regexPath:"[provided regex path]",availableFiles:"[list of files in zip]"}},FILE_PROCESSING_FAIL_GENERAL:{type:"FILE_PROCESSING_FAIL_GENERAL",category:ze.FILE_PROCESSING,scope:je.BLUEPRINT,i18nDetail:"errors.file-processing-fail-general",level:We.CRITICAL,context:{blueprintId:"[blueprint ID]",error:"[the error that occurred]"}},STRING_CONVERSION_ERROR:{type:"STRING_CONVERSION_ERROR",category:ze.FILE_PROCESSING,scope:je.FILE,i18nDetail:"errors.string-conversion-error",level:We.CRITICAL,context:{}},NO_EXTRACTION_RULES:{type:"NO_EXTRACTION_RULES",category:ze.BLUEPRINT_SPECIFICATION,scope:je.BLUEPRINT,i18nDetail:"errors.no-extraction-rules",level:We.CRITICAL,context:{blueprintId:"[blueprint ID]"}},PARSING_ERROR:{type:"PARSING_ERROR",category:ze.FILE_PROCESSING,scope:je.BLUEPRINT,i18nDetail:"errors.parsing-error",level:We.CRITICAL,context:{blueprintId:"[blueprint ID]",contentType:"[the type of content it tried to parse]"}},UNSUPPORTED_BP_FORMAT:{type:"UNSUPPORTED_BP_FORMAT",category:ze.BLUEPRINT_SPECIFICATION,scope:je.BLUEPRINT,i18nDetail:"errors.unsupported-bp-format",level:We.CRITICAL,context:{blueprintId:"[blueprint ID]",format:"[name of unsupported format]"}},MORE_THAN_ONE_KEY_MATCH:{type:"MORE_THAN_ONE_KEY_MATCH",category:ze.EXTRACTION,scope:je.BLUEPRINT,i18nDetail:"errors.more-than-one-key-match",level:We.INFO,context:{blueprintId:"[blueprint ID]",field:"[the field for which multiple matches were found]",keys:"[the keys that were matched]",defaultKey:"[the fallback key used]"}}};function Qe(e,t,n={}){const a={type:t.type,category:t.category,scope:t.scope,i18nDetail:t.i18nDetail,level:t.level,context:{...t.context,...n}};e.push(a)}var Je=n(809),qe=n.n(Je),Ye=n(641);function et(e){return"string"!==typeof e?JSON.stringify(e):e}function tt(e){return"number"===typeof e||"string"==typeof e&&(!isNaN(parseFloat(e))&&isFinite(Number(e)))}function nt(e,t){try{return!(!Ye.c9.fromISO(e).isValid||!Ye.c9.fromISO(t).isValid)||(!(!Ye.c9.fromRFC2822(e).isValid||!Ye.c9.fromRFC2822(t).isValid)||!(!Ye.c9.fromHTTP(e).isValid||!Ye.c9.fromHTTP(t).isValid))}catch(n){return console.warn("[bothDates] Error checking date formats:",n),!1}}function at(e,t){try{if(Ye.c9.fromISO(e).isValid&&Ye.c9.fromISO(t).isValid)return[Ye.c9.fromISO(e),Ye.c9.fromISO(t)];if(Ye.c9.fromRFC2822(e).isValid&&Ye.c9.fromRFC2822(t).isValid)return[Ye.c9.fromRFC2822(e),Ye.c9.fromRFC2822(t)];if(Ye.c9.fromHTTP(e).isValid&&Ye.c9.fromHTTP(t).isValid)return[Ye.c9.fromHTTP(e),Ye.c9.fromHTTP(t)]}catch(n){console.warn(`[getDates] Error parsing dates: ${n}`)}return[null,null]}function rt(e,t){if(nt(e,t)){const[n,a]=at(e,t);return[n,a]}return tt(e)&&tt(t)?[parseFloat(e),parseFloat(t)]:(e=et(e),t=et(t),[e,t])}function ot(e,t){try{return e=et(e),t=et(t),e===t}catch(n){return console.warn("Error comparing values for equality:",n),!1}}function it(e,t){try{return e=et(e),t=et(t),e!==t}catch(n){return console.warn("Error comparing values for inequality:",n),!1}}function lt(e,t,n){try{if(nt(e,t)||tt(e)&&tt(t)){const[a,r]=rt(e,t);return null!==a&&null!==r&&n(a,r)}}catch(a){console.warn("Error comparing values:",a)}return!1}function st(e,t){return lt(e,t,((e,t)=>e<=t))}function ct(e,t){return lt(e,t,((e,t)=>e>=t))}function ut(e,t){return lt(e,t,((e,t)=>e<t))}function dt(e,t){return lt(e,t,((e,t)=>e>t))}function pt(e,t){const n=et(e),a=RegExp(t,"g");return n.replaceAll(a,"")}function ft(e,t,n){const a=et(e),r=RegExp(t,"g");return a.replaceAll(r,n)}function bt(e,t){const n=et(e),a=RegExp(t,"g");return a.test(n)}function vt(e,t,n){let a=[];for(const r of t){const t=n?Object.keys(e).some((e=>new RegExp(r).test(e))):Object.prototype.hasOwnProperty.call(e,r);t||a.push(r)}return a}function gt(e,t,n,a){const r=new Map;for(const o of t){const t=Object.keys(e).filter((e=>{if(o.regex_field)try{return new RegExp(o.field).test(e)}catch(t){return a[n].registerError(He.INVALID_REGEX,{blueprintId:n,ruleId:o.id,ruleRegex:o.field}),!1}return o.field===e}));if(t.length>1){const e={field:o.field,keys:t,defaultKey:t[0]};a[n].registerError(He.MORE_THAN_ONE_KEY_MATCH,e),r.set(o.field,t[0]),a[n].mapExtractedField(o.field,t[0])}else 0===t.length?a[n].registerNoKeyMatch(o.field,Object.keys(e)):(r.set(o.field,t[0]),a[n].mapExtractedField(o.field,t[0]))}return r}function mt(e,t,n,a,r){const o={};for(const i of t){const t=n.get(i.field);if(void 0===t)break;switch(i.comparison_operator){case null:o[i.field]=e[t];break;case"==":if(ot(e[t],i.comparison_value))return ht(i,a,r);break;case"!=":if(it(e[t],i.comparison_value))return ht(i,a,r);break;case"<=":if(st(e[t],i.comparison_value))return ht(i,a,r);break;case">=":if(ct(e[t],i.comparison_value))return ht(i,a,r);break;case"<":if(ut(e[t],i.comparison_value))return ht(i,a,r);break;case">":if(dt(e[t],i.comparison_value))return ht(i,a,r);break;case"regex-delete-match":if(t in o)try{let n=pt(e[t],i.comparison_value);o[i.field]=n,e[t]=n,r[a].extractionRuleLog[i.id]+=1}catch{o[i.field]=e[t]}break;case"regex-replace-match":if(t in o)try{let n=ft(e[t],i.comparison_value,i.replacement_value);o[i.field]=n,e[t]=n,r[a].extractionRuleLog[i.id]+=1}catch{o[i.field]=e[t]}break;case"regex-delete-row":if(t in e){let n=!1;try{n=bt(e[t],i.comparison_value)}catch{break}if(n)return ht(i,a,r)}break;default:break}}Object.keys(o).length>0&&r[a].extractedData.push(o)}function ht(e,t,n){n[t].incrementExtractionRuleCount(e)}function Et(e,t,n){if(0===t.extraction_rules.length)return void n[t.id].registerError(He.NO_EXTRACTION_RULES,{});const a=yt(e,t,n);if(a){n[t.id].extractionStats.nRowsTotal=a.length;for(const e of a){if(null==e)continue;const a=vt(e,t.expected_fields,t.exp_fields_regex_matching);if(a.length>0){n[t.id].extractionStats.nRowsMissingField+=1;continue}const r=gt(e,t.extraction_rules,t.id,n);mt(e,t.extraction_rules,r,t.id,n)}}else n[t.id].registerError(He.PARSING_ERROR,{contentType:""})}function yt(e,t,n){let a=null;if("json"===t.format)try{a=xt(e,t.json_extraction_root)}catch(r){n[t.id].registerError(He.PARSING_ERROR,{contentType:"JSON",error:r})}else{if("csv"!==t.format)return n[t.id].registerError(He.UNSUPPORTED_BP_FORMAT,{format:t.format}),null;try{a=kt(e,t.csv_delimiter)}catch(r){n[t.id].registerError(He.PARSING_ERROR,{contentType:"CSV",error:r})}}return a||(n[t.id].registerError(He.PARSING_ERROR,{contentType:t.format}),null)}function xt(e,t){let n;try{n=JSON.parse(e)}catch(a){throw new Error(`Failed to parse JSON content: ${a}`)}if(t&&""!==t)try{n=It(n,t)}catch(a){throw new Error(`Failed to get nested JSON content: ${a}`)}return Symbol.iterator in Object(n)||(n=new Array(n)),n}function kt(e,t){try{const n=qe().parse(e,{header:!0,delimiter:t,skipEmptyLines:!0,dynamicTyping:!1});if(n.errors.length>0)throw new Error(`CSV parsing errors: ${n.errors}`);return n.data}catch(n){throw new Error(`An error occurred during csv parsing: ${n}`)}}function It(e,t){if("object"!==typeof e||null==e)return;const n=t.replace(/\[(\w+)]/g,".$1").replace(/^\./,"").split(".");let a=e;for(const r of n){if(null==a||!(r in a))return;a=a[r]}return a}async function Ct(e,t,n,a){if(!wt(e)){const t=e.name.slice(e.name.lastIndexOf(".")+1);return void Qe(a,He.INVALID_ZIP,{fileType:t})}let r;try{r=await Ze().loadAsync(e)}catch(o){return void Qe(a,He.ZIP_READ_FAIL,{error:o})}for(const i of t){let e;try{e=new RegExp(i.regex_path)}catch(o){n[i.id].registerError(He.INVALID_REGEX,{error:o});continue}const t=r.file(e);if(0!==t.length)for(const a of t)try{const e=await a.async("string");Et(e,i,n)}catch(o){n[i.id].registerError(He.FILE_PROCESSING_FAIL_GENERAL,{error:o})}else{const e=Object.keys(r.files),t={regexPath:i.regex_path,availableFiles:e};n[i.id].registerError(He.NO_FILE_MATCH,t)}}}function Rt(e,t,n,a){return new Promise(((r,o)=>{const i=new FileReader;i.onload=function(e){const i=e.target.result;if("string"!==typeof i)return Qe(a,He.STRING_CONVERSION_ERROR,{}),o("invalid content");t.forEach((e=>{try{Et(i,e,n)}catch(t){n[e.id].registerError(He.FILE_PROCESSING_FAIL_GENERAL,{error:t})}})),r()},i.onerror=function(e){const t=e.target?.error||new Error("Unknown file reading error");Qe(a,He.FILE_PROCESSING_FAIL_GENERAL,{error:t}),o(t)},i.readAsText(e)}))}function wt(e){const t=e.name.toLowerCase().endsWith(".zip"),n=["application/zip","application/x-zip-compressed","multipart/x-zip"].includes(e.type);return t&&n}function _t(e,t){const n=(0,a.Kh)([]),r=(0,a.Kh)({});function o(){n.length=0,Object.keys(r).forEach((e=>{delete r[e]}));for(const e of t)r[e.id]=new Ve(e)}function i(){o()}async function l(a){o();try{await new Promise((e=>setTimeout(e,1e3))),e?await Ct(a,t,r,n):await Rt(a,t,r,n)}catch(i){console.error("Unexpected error during file processing:",i)}}return i(),{generalErrors:n,blueprintOutcomeMap:r,handleSelectedFile:l}}function Lt(e,t){const{t:n}=(0,r.s9)({locale:"en"});let o=(0,a.KR)(Date.now());async function i(e,t){o.value=Date.now();for(const a of e)await l(null,a.type,n(a.i18nDetail,a.context));for(const a of Object.values(t)){for(const t of a.processingErrors)"NO_FILE_MATCH"===t.type?await l(a.blueprintId,t.type,n(`${t.i18nDetail}-detail`,t.context)):await l(a.blueprintId,t.type,n(t.i18nDetail,t.context));const e={EXTRACTION_STATS:a.extractionStats,EXTRACTION_LOG:a.extractionRuleLog,EXTRACTED_FIELDS_MAP:a.extractedFieldsMap};for(const[t,n]of Object.entries(e))await l(a.blueprintId,t,JSON.stringify(n))}}async function l(n,a,r){const i={status_code:a,message:r,raised_by:"client",uploader:e,blueprint:n,date:new Date(o.value).toISOString()};try{const e=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});return!!e.ok||(console.error(`Error posting log: ${e.status} ${e.statusText}`),!1)}catch(l){return console.error("Could not post error message:",l),!1}}return{postLogs:i}}const St={class:"uploader-name"},Dt={class:"uploader-container"},Nt={class:"uploader-section"},Ot={class:"uploader-section"},Tt={class:"uploader-section"},At={key:0,class:"uploader-section"};var Ft=(0,a.pM)({__name:"UploaderWrapper",props:{blueprintConfigs:{},combinedConsent:{type:Boolean},componentId:{},exceptionUrl:{},expectsZip:{type:Boolean},instructionConfig:{},name:{}},emits:["statusChanged"],setup(e,{emit:t}){const{t:n,locale:o}=(0,r.s9)(),i=e,l=t;let s=(0,a.KR)(ae.IDLE);const{generalErrors:c,blueprintOutcomeMap:u,handleSelectedFile:d}=_t(i.expectsZip,i.blueprintConfigs),{postLogs:p}=Lt(i.componentId,i.exceptionUrl);async function f(e){s.value=ae.PROCESSING,await d(e),E(),k(),p(c,u).catch((e=>{console.error("Logs could not be posted to backend:",e)})),s.value=ae.DONE}const{extractionState:b,generalErrorsToDisplay:m,blueprintExtractionStates:h,getExtractionState:E}=Be(c,u),{blueprintConsentMap:y,updateConsent:x}=Ge(i.blueprintConfigs,i.combinedConsent);function k(){l("statusChanged",i.componentId,y.value,b.value,h.value,u)}(0,a.wB)(y,(()=>{k()}),{deep:!0}),(0,a.sV)((()=>{k()}));const I=(0,a.EW)((()=>b.value===g.SUCCESS||b.value===g.PARTIAL)),C=(0,a.EW)((()=>!0===i.combinedConsent&&I.value));return(e,t)=>((0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("div",St,(0,a.v_)(e.name),1),(0,a.Lk)("div",Dt,[(0,a.Lk)("div",Nt,[(0,a.bF)(Ke,{instructions:e.instructionConfig,"component-id":e.componentId},null,8,["instructions","component-id"])]),(0,a.Lk)("div",Ot,[(0,a.bF)(Se,{"expects-zip":i.expectsZip,"uploader-state":(0,a.R1)(s),"extraction-state":(0,a.R1)(b),"general-errors":(0,a.R1)(m),onFileDropped:f},null,8,["expects-zip","uploader-state","extraction-state","general-errors"])]),(0,a.Lk)("div",Tt,[(0,a.bF)(ne,{"uploader-state":(0,a.R1)(s),"extraction-state":(0,a.R1)(b),blueprints:i.blueprintConfigs,"blueprint-extraction-states":(0,a.R1)(h),"blueprint-outcome-map":(0,a.R1)(u),"combined-consent":e.combinedConsent,onConsentUpdated:(0,a.R1)(x)},null,8,["uploader-state","extraction-state","blueprints","blueprint-extraction-states","blueprint-outcome-map","combined-consent","onConsentUpdated"])]),C.value?((0,a.uX)(),(0,a.CE)("div",At,[(0,a.bF)(v,{"combined-consent":e.combinedConsent,"blueprint-id":null,onConsentUpdated:(0,a.R1)(x)},null,8,["combined-consent","onConsentUpdated"])])):(0,a.Q3)("",!0)])],64))}});const Pt=(0,f.A)(Ft,[["__scopeId","data-v-2ca6fab1"]]);var Ut=Pt;const Mt={class:"issue-modal",role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",tabindex:"-1"},Xt={class:"modal-body d-flex flex-row align-items-center pt-5"},Kt={id:"modal-title",class:"visually-hidden"},Gt={key:0},Wt={key:1},jt={key:2},zt={class:"modal-footer"};var Bt=(0,a.pM)({__name:"IssueModal",props:{unattendedUploaderShare:{},unattendedUploaderNames:{},blueprintsWithoutConsentCount:{},blueprintsWithoutConsentNames:{},allUploadersValid:{type:[Boolean,null]},showModal:{type:Boolean}},emits:["continueAnyway","modalClosed"],setup(e,{emit:t}){const{t:n,locale:o}=(0,r.s9)(),i=e,l=t,s=(0,a.KR)(!1),c=(0,a.EW)((()=>0===i.blueprintsWithoutConsentCount));(0,a.wB)((()=>i.showModal),(()=>{s.value=i.showModal}),{immediate:!0});const u=()=>{s.value=!1,l("modalClosed")},d=e=>{const t=e.length;if(0===t)return"";let n=" (";for(let a=0;a<t;a++)n+='"'+e[a]+'"',(a<t-2||a===t-2)&&(n+=", ");return n+=")",n};function p(e){"Escape"===e.key&&u()}return(0,a.sV)((()=>{window.addEventListener("keydown",p)})),(0,a.hi)((()=>{window.removeEventListener("keydown",p)})),(e,t)=>s.value?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.Lk)("div",{class:"modal-backdrop",onClick:u}),(0,a.Lk)("div",Mt,[(0,a.Lk)("div",Xt,[(0,a.Lk)("h2",Kt,(0,a.v_)((0,a.R1)(n)("issue-modal.title")),1),t[1]||(t[1]=(0,a.Lk)("div",{class:"ps-2 pe-3 color-blue"},[(0,a.Lk)("i",{class:"bi bi-info-circle-fill fs-1"})],-1)),(0,a.Lk)("div",null,[1===e.unattendedUploaderShare?((0,a.uX)(),(0,a.CE)("div",Gt,(0,a.v_)((0,a.R1)(n)("issue-modal.none-attempted")),1)):e.unattendedUploaderShare>0?((0,a.uX)(),(0,a.CE)("div",Wt,(0,a.v_)((0,a.R1)(n)("issue-modal.not-all-attempted",{"skipped-uploads":d(i.unattendedUploaderNames)})),1)):(0,a.Q3)("",!0),e.blueprintsWithoutConsentCount>0&&e.unattendedUploaderShare<1?((0,a.uX)(),(0,a.CE)("div",jt,(0,a.v_)((0,a.R1)(n)("issue-modal.not-all-consented",{"blueprints-wo-consent":d(i.blueprintsWithoutConsentNames)})),1)):(0,a.Q3)("",!0)])]),(0,a.Lk)("div",zt,[(0,a.Lk)("button",{type:"button",class:"btn btn-primary",onClick:u},(0,a.v_)((0,a.R1)(n)("issue-modal.back")),1),c.value?((0,a.uX)(),(0,a.CE)("button",{key:0,type:"button",class:"btn btn-light",onClick:t[0]||(t[0]=e=>{u(),l("continueAnyway")})},(0,a.v_)((0,a.R1)(n)("issue-modal.continue-anyway")),1)):(0,a.Q3)("",!0)])])],64)):(0,a.Q3)("",!0)}});const Vt=(0,f.A)(Bt,[["__scopeId","data-v-1c0f1c69"]]);var $t=Vt;function Zt(e){const t=(0,a.KR)([]),n=(0,a.KR)([]),r=(0,a.KR)(0),o=(0,a.KR)(null),i=(0,a.EW)((()=>{const n=Object.keys(e.value).length;if(0===n)return 0;const a=t.value.length;return a/n}));function l(){return s()&&c()?(o.value=!0,!0):(o.value=!1,!1)}const s=()=>{t.value=[];for(const n of Object.values(e.value))n.uploaderState===g.PENDING&&t.value.push(n.uploaderName);return 0===t.value.length},c=()=>{n.value=[],r.value=0;for(const t of Object.values(e.value))if(t.consentMap)for(const e of Object.keys(t.consentMap))null===t.consentMap[e]&&t.blueprintStates[e].state===g.SUCCESS&&n.value.push(t.blueprintNames[e]);else console.log(`Uploader ${t.uploaderName} is missing consentMap.`);return 0===n.value.length};return{validateUploaders:l,unattendedUploaderShare:i,unattendedUploaderNames:t,blueprintsWithoutConsentCount:r,blueprintsWithoutConsentNames:n,allUploadersValid:o}}function Ht(e,t){const n=(0,a.KR)(!1);function r(){const t={};for(const n of Object.values(e.value))if(n.extractionOutcome)for(const e of Object.values(n.extractionOutcome)){let a=[];!0===n.consentMap[e.blueprintId]&&(a=e.extractedData),t[e.blueprintId]={consent:n.consentMap[e.blueprintId],extractedData:a,status:n.blueprintStates[e.blueprintId].state}}return t}async function o(e,t){const n=new(Ze());return n.file(t,JSON.stringify(e)),await n.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:5}})}async function i(){n.value=!0;const e=r();if(0===Object.keys(e).length)return console.warn("No data to submit"),!1;const a=await o(e,"data_donation.json"),i=document.getElementById("uploader-form");if(!i)return console.error("Form element not found"),!1;const l=new FormData(i);l.append("post_data",a);try{const e=await fetch(t,{method:"POST",body:l});return e.redirected&&(window.location.href=e.url),!0}catch(s){console.error("Error during data submission to server:",s)}finally{n.value=!1}}return{submitting:n,submitDonation:i}}const Qt={class:"custom-modal",id:"processingModal",role:"dialog","aria-modal":"true","aria-labelledby":"loading-message","aria-live":"assertive"},Jt={class:"modal-dialog modal-dialog-centered custom-modal-container m-0"},qt={class:"modal-content fs-1 text-center custom-modal-content"},Yt={id:"loading-message",class:"p-3 modal-message"};var en=(0,a.pM)({__name:"SubmittingOverlay",setup(e){const{t:t,locale:n}=(0,r.s9)();return(e,n)=>((0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("div",Qt,[(0,a.Lk)("div",Jt,[(0,a.Lk)("div",qt,[(0,a.Lk)("div",Yt,(0,a.v_)((0,a.R1)(t)("submitting-modal.submit-wait")),1),n[0]||(n[0]=(0,a.Lk)("div",{class:"dot-floating","aria-hidden":"true"},null,-1))])])]),n[1]||(n[1]=(0,a.Lk)("div",{class:"modal-backdrop"},null,-1))],64))}});const tn=(0,f.A)(en,[["__scopeId","data-v-2fab3ad3"]]);var nn=tn;const an={class:"ddm-uploader"},rn={class:"row"},on={class:"col"},ln={id:"uploader-form",method:"POST",enctype:"multipart/form-data"},sn=["value"];var cn=(0,a.pM)({__name:"UploaderApp",props:{uploaderConfigs:{},actionUrl:{},exceptionUrl:{},language:{},csrfToken:{}},setup(e){const{t:t,locale:n}=(0,r.s9)(),o=e,i=(0,a.KR)(y()),{validateUploaders:l,unattendedUploaderShare:s,unattendedUploaderNames:c,blueprintsWithoutConsentCount:u,blueprintsWithoutConsentNames:d,allUploadersValid:p}=Zt(i),{submitting:f,submitDonation:b}=Ht(i,o.actionUrl);function v(e,t,n,a,r){const o=i.value[e];o&&Object.assign(o,{consentMap:t,uploaderState:n,blueprintStates:a,extractionOutcome:r})}let g=(0,a.KR)(!1);function m(){g.value=!1}function h(){l(),p.value?b():g.value=!0}function E(e){const t={};for(const n of e.blueprints)t[n.id]=n.name;return t}function y(){const e={};for(const t of o.uploaderConfigs)e[t.uploader_id]={uploaderName:t.name,blueprintNames:E(t),consentMap:null,uploaderState:null,blueprintStates:null,extractionOutcome:null};return e}return(e,n)=>((0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("div",an,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.uploaderConfigs,(e=>((0,a.uX)(),(0,a.Wv)(Ut,{"blueprint-configs":e.blueprints,"combined-consent":e.combined_consent,componentId:e.uploader_id,"exception-url":o.exceptionUrl,"expects-zip":"zip file"===e.upload_type,"instruction-config":e.instructions,name:e.name,onStatusChanged:v},null,8,["blueprint-configs","combined-consent","componentId","exception-url","expects-zip","instruction-config","name"])))),256))]),(0,a.bF)($t,{"unattended-uploader-share":(0,a.R1)(s),"unattended-uploader-names":(0,a.R1)(c),"blueprints-without-consent-count":(0,a.R1)(u),"blueprints-without-consent-names":(0,a.R1)(d),"all-uploaders-valid":(0,a.R1)(p),"show-modal":(0,a.R1)(g),onContinueAnyway:(0,a.R1)(b),onModalClosed:m},null,8,["unattended-uploader-share","unattended-uploader-names","blueprints-without-consent-count","blueprints-without-consent-names","all-uploaders-valid","show-modal","onContinueAnyway"]),(0,a.R1)(f)?((0,a.uX)(),(0,a.Wv)(nn,{key:0})):(0,a.Q3)("",!0),(0,a.Lk)("div",rn,[(0,a.Lk)("div",on,[(0,a.Lk)("button",{class:"flow-btn",type:"button",onClick:h},(0,a.v_)((0,a.R1)(t)("uploader-app.next-btn"))+"  ›",1)])]),(0,a.bo)((0,a.Lk)("form",ln,[(0,a.Lk)("input",{type:"hidden",name:"csrfmiddlewaretoken",value:e.csrfToken},null,8,sn)],512),[[a.aG,!1]])],64))}});const un=cn;var dn=un,pn=JSON.parse('{"instructions":{"heading":"How it works"},"errors":{"invalid-zip":"A ZIP-file was expected but a {fileType}-file was uploaded.","zip-read-fail":"Failed to read ZIP archive","invalid-regex":"Invalid regex","invalid-rule-regex":"The field name \'{ruleRegex}\' of extraction rule {ruleId} could not be parsed as regex.","no-file-match":"The selected ZIP-container did not contain the correct file. Files in container: {availableFiles}","no-file-match-detail":"We tried to identify the file using the following pattern: \'{regexPath}\'. \\nAvailable files in the container: {availableFiles}","file-processing-fail-general":"An error occurred during processing the file content.","file-processing-fail-general-detail":"The following error occurred: {error}","string-conversion-error":"File content cannot be converted to string","no-extraction-rules":"No extraction rules defined.","parsing-error":"Failed to parse {contentType} content for this file.","unsupported-bp-format":"Unsupported content format: {format}","more-than-one-key-match":"More than one key match for field \'{field}\': {keys}. Defaulted to {defaultKey}","no-key-match":"No key match for field \'{field}\': {keys}","undefined-key":"Undefined key for field \'{field}\'"},"file-drop":{"heading":"Select file","selection-prompt":"Click to select a file from your device","release-to-select":"Drop the file to continue","file-is-being-processed":"Processing your file...","processing-complete":"Processing complete","processing-success":"File successfully processed","processing-failed":"The file could not be successfully processed","choose-different-file":"select a different file","retry-hint":"The file may not contain the right information. See below for more details or try again by selecting a different file:"},"extraction-state":{"file":{"success":"Below you can see which data were extracted.","no-data-extracted":"No information could be extracted from the file."},"blueprint":{"success":"Your data has been successfully extracted","no-data-extracted":"No relevant data found in the file.","all-missing-fields":"Required information was missing from all entries in the file.","all-filtered-out":"All entries in the file were excluded based on the filtering criteria.","failed":"Data could not be extracted due to the following issue(s):"}},"feedback":{"intro-extraction-pending":"Data to be extracted","intro-extraction-complete":"Extracted data","show-error-details":"Show details","donation-question":"Do you agree to donate and submit the data listed above?","donation-agree":"Yes","donation-disagree":"No"},"extraction-table":{"previous-page":"previous page","next-page":"next page","page-info":"Page {currentPage} of {maxPage}","entry-info":"Displaying entries {lower}-{upper} of {total}.","donation-info":"If you consent to the donation, the following data will be submitted:","search-entries":"Search entries...","all-filtered":"No entries found","show-data":"Show all data","hide-data":"Show less"},"uploader-app":{"next-btn":"Next"},"issue-modal":{"title":"Data donation not complete","none-attempted":"You have not uploaded any files. Continue without a donation?","not-all-attempted":"Some uploads were skipped{skipped-uploads}. Continue with the files processed so far?","not-all-consented":"For some data, it was not indicated whether these may be transmitted{ blueprints-wo-consent }. Please go back to review.","continue-anyway":"Yes, continue anyway","back":"Go back"},"submitting-modal":{"submit-wait":"Processing your data donation..."}}'),fn=JSON.parse('{"instructions":{"heading":"So funktioniert es"},"errors":{"invalid-zip":"Eine ZIP-Datei wurde erwartet, aber eine {fileType}-Datei wurde hochgeladen.","zip-read-fail":"ZIP-Archiv konnte nicht gelesen werden","invalid-regex":"Ungültiger regulärer Ausdruck (regex)","invalid-rule-regex":"Der Feldname \'{ruleRegex}\' der Extraction Rule {ruleId} konnte nicht korrekt in eine RegEx umgewandelt werden.","no-file-match":"Diese Datei konnte im ausgewählten ZIP-Container nicht gefunden werden.","no-file-match-detail":"Keine Datei konnte mit dem folgenden Muster identifiziert werden: \'{regexPath}\'. \\nVerfügbare Dateien im ZIP-Container: {availableFiles}","file-processing-fail-general":"Beim Verarbeiten des Datei-Inhalts ist ein Fehler aufgetreten","file-processing-fail-general-detail":"Der folgende Fehler trat auf: {error}","string-conversion-error":"Dateiinhalt kann nicht in einen Text (String) umgewandelt werden","no-extraction-rules":"Es wurden keine Extraktionsregeln definiert","parsing-error":"Es trat ein Fehler beim Parsen von {contentType}-Inhalt für diese Datei auf","unsupported-bp-format":"Nicht unterstütztes Dateiformat: {format}","more-than-one-key-match":"Mehr als eine Übereinstimmung für Feld \'{field}\': {keys}. Es wurde standardmäßig \'{defaultKey}\' verwendet","no-key-match":"Keine Übereinstimmung für Feld \'{field}\': {keys}","undefined-key":"Undefinierter Name für Feld \'{field}\'"},"file-drop":{"heading":"Datei auswählen","selection-prompt":"Hier klicken um eine Datei auszuwählen","release-to-select":"Loslassen, um Datei auszuwählen","file-is-being-processed":"Datei wird verarbeitet…","processing-complete":"Verarbeitung abgeschlossen","processing-success":"Datei erfolgreich verarbeitet","processing-failed":"Datei konnte nicht verarbeitet werden","choose-different-file":"eine andere Datei auswählen","retry-hint":"Die ausgewählte Datei enthält möglicherweise nicht die benötigten Informationen (siehe unten für weitere Details). Eine andere Datei auswählen, um es erneut zu versuchen:"},"extraction-state":{"file":{"success":"Unten werden die ausgelesenen Daten angezeigt.","no-data-extracted":"Es konnten keine Informationen aus der Datei ausgelesen werden."},"blueprint":{"success":"Daten erfolgreich ausgelesen.","no-data-extracted":"Keine relevanten Daten in der Datei gefunden.","all-missing-fields":"Alle Einträge in der Datei sind unvollständig und können nicht ausgelesen werden.","all-filtered-out":"Alle Einträge wurden aufgrund der gewählten Filter-Kriterien ausgeschlossen.","failed":"Es konnten keine Daten ausgelesen werden, aufgrund von folgenden Fehlern:"}},"feedback":{"intro-extraction-pending":"Die folgenden Daten werden ausgelesen","intro-extraction-complete":"Ausgelesene Daten","show-error-details":"Details anzeigen","donation-question":"Sind Sie damit einverstanden, diese Daten zu spenden und zu übermitteln?","donation-agree":"Ja","donation-disagree":"Nein"},"extraction-table":{"previous-page":"vorherige Seite","next-page":"nächste Seite","page-info":"Seite {currentPage} von {maxPage}","entry-info":"Einträge {lower} bis {upper} von insgesamt {total} werden angezeigt.","donation-info":"Wenn Sie der Datenspende zustimmen, werden die folgenden Daten übermittelt:","search-entries":"Einträge durchsuchen...","all-filtered":"Keine Einträge gefunden","show-data":"alle Daten anzeigen","hide-data":"weniger anzeigen"},"uploader-app":{"next-btn":"Weiter"},"issue-modal":{"title":"Datenspende wurde nicht abgeschlossen","none-attempted":"Es wurden keine Dateien hochgeladen. Ohne Datenspende fortfahren?","not-all-attempted":"Einige Uploads wurden übersprungen{skipped-uploads}. Mit den bisher verarbeiteten Dateien fortfahren?","not-all-consented":"Für einige Daten wurde nicht angegeben, ob diese übermittelt werden dürfen{ blueprints-wo-consent }. Bitte überprüfen.","continue-anyway":"Trotzdem fortfahren","back":"Zurück"},"submitting-modal":{"submit-wait":"Die Datenspende wird verarbeitet..."}}');function bn(){const e={selector:"#uapp",defaultLocale:"en",fallbackLocale:"en"},t=(0,r.hU)({legacy:!1,locale:e.defaultLocale,fallbackLocale:e.fallbackLocale,messages:{en:pn,de:fn}}),n=document.querySelector(e.selector);if(!n)throw console.error(`Mount element not found using selector: "${e.selector}"`),new Error(`Failed to initialize uploader: Mount element "${e.selector}" not found`);const o=["actionUrl","csrfToken","uploaderConfigsAsString","exceptionUrl"];for(const a of o){const e=a.charAt(0).toLowerCase()+a.slice(1);if(!n.dataset[e])throw new Error(`Required attribute data-${a.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`))} is missing`)}const i=n.dataset.uploaderConfigsAsString;let l=[];try{l=JSON.parse(i??"[]")}catch(d){console.error("Failed to parse uploadConfig:",d)}const s=(0,a.Ef)(dn,{actionUrl:n.dataset.actionUrl,exceptionUrl:n.dataset.exceptionUrl,language:n.dataset.language,uploaderConfigs:l,csrfToken:n.dataset.csrfToken}),c=n.dataset.language||e.defaultLocale,u=t.global.availableLocales;u.includes(c)?t.global.locale.value=c:t.global.locale.value=e.fallbackLocale,s.use(t),s.mount(e.selector)}bn()}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var o=t[a]={exports:{}};return e[a].call(o.exports,o,o.exports,n),o.exports}n.m=e,function(){var e=[];n.O=function(t,a,r,o){if(!a){var i=1/0;for(u=0;u<e.length;u++){a=e[u][0],r=e[u][1],o=e[u][2];for(var l=!0,s=0;s<a.length;s++)(!1&o||i>=o)&&Object.keys(n.O).every((function(e){return n.O[e](a[s])}))?a.splice(s--,1):(l=!1,o<i&&(i=o));if(l){e.splice(u--,1);var c=r();void 0!==c&&(t=c)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[a,r,o]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={256:0};n.O.j=function(t){return 0===e[t]};var t=function(t,a){var r,o,i=a[0],l=a[1],s=a[2],c=0;if(i.some((function(t){return 0!==e[t]}))){for(r in l)n.o(l,r)&&(n.m[r]=l[r]);if(s)var u=s(n)}for(t&&t(a);c<i.length;c++)o=i[c],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(u)},a=self["webpackChunkddm_uploader_frontend"]=self["webpackChunkddm_uploader_frontend"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=n.O(void 0,[504],(function(){return n(782)}));a=n.O(a)})();
//# sourceMappingURL=ddm_uploader_frontend.js.map