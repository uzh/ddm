<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DDM | Documentation for System Administrators</title>
    <link rel="prev" href="for_researchers.html">
    <link rel="next" href="for_developers.html">
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
    <link rel="icon" href="../../_/img/ddl_favicon_black.svg" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div>
        <a class="navbar-item"><img src="../../_/img/DDM_Logo_Schwarz.svg" height="50px"></a>
      </div>
      <div class="navbar-slogan">
        <a class="navbar-item">Data Donation Module Documentation</a>
      </div>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <!--
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
      -->
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ddm" data-version="v1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <!-- 
    <h3 class="title"><a href="index.html">DDM</a></h3>
     -->
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link nav-link-1" href="for_researchers.html">For Researchers</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link nav-link-1" href="for_admins.html">For System Administrators</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link nav-link-1" href="for_developers.html">For Developers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link nav-link-1" href="topic_references.html">Topic References</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link nav-link-1" href="issues.html">Reporting Issues and Getting Help</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">DDM</span>
    <span class="version">v1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../main/index.html">DDM</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../main/index.html">main</a>
        </li>
        <li class="version">
          <a href="../develop/index.html">develop</a>
        </li>
        <li class="version">
          <a href="../v1.0.19/index.html">v1.0.19</a>
        </li>
        <li class="version is-current">
          <a href="index.html">v1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<!--
-->
<!-- <nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">DDM</a></li>
    <li><a href="for_admins.html">For System Administrators</a></li>
  </ul>
</nav>
 -->
<!-- <div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">v1.0.0</button>
  <div class="version-menu">
    <a class="version is-missing" href="../main/index.html">main</a>
    <a class="version is-missing" href="../develop/index.html">develop</a>
    <a class="version" href="../v1.0.19/for_admins.html">v1.0.19</a>
    <a class="version is-current" href="for_admins.html">v1.0.0</a>
  </div>
</div>
 -->
<!--
-->
</div>
  <div class="content">
<aside class="toc sidebar" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
  <nav class="breadcrumbs-article" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">DDM</a></li>
    <li>        <span class="is-current">For System Administrators</span>
</li>
  </ul>
</nav>
  <h1 class="page">Documentation for System Administrators</h1>
  <div class="sect1">
<h2 id="_getting_started"><a class="anchor" href="#_getting_started"></a>Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>DDM is a web application that builds on <a href="https://www.djangoproject.com/">Django</a>, a Python web framework.
Therefore, to run DDM you first need to install Python (3.8 or newer) and Django 3.2.</p>
</div>
<div class="paragraph">
<p>For the installation of Python, please go to the official Python website: <a href="https://www.python.org/">python.org</a></p>
</div>
<div class="paragraph">
<p>The installation of Django is described in the next section. If you are planning
to install DDM for production use, we advise to follow a comprehensive tutorial
such as the one provided by <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-django-with-postgres-nginx-and-gunicorn-on-ubuntu-22-04">Digital Ocean</a>.</p>
</div>
<div class="sect2">
<h3 id="_install_django"><a class="anchor" href="#_install_django"></a>Install Django</h3>
<div class="paragraph">
<p>To install Django and DDM, we strongly advise to use a new virtual environment (venv) for the installation.
To create a new venv, run the following command in the folder where you want your installation to be located
(the commands listed here should work for Linux and macOS; for other setups see <a href="https://www.w3schools.com/django/django_create_virtual_environment.php">here</a>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">ProjectPath&gt; python -m venv /path/to/venv</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can activate the environment as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">ProjectPath&gt; source /path/to/venv/bin/activate
(venv) ProjectPath&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, install Django in your virtual environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">(venv) ProjectPath&gt; pip install Django==3.2.*</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that Django is installed, start a new project and access it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">(venv) ProjectPath&gt; django-admin startproject yourproject
(venv) ProjectPath&gt; cd yourproject</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create a new folder <code>yourproject</code> that contains a file called <code>manage.py</code>
and a folder that is also called <code>yourproject</code>. In this subfolder you will find, among others,
the <code>settings.py</code> and the <code>urls.py</code> file.</p>
</div>
<div class="paragraph">
<p>Next, create a superuser account with your Django project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">(venv) ProjectPath/yourproject&gt; python manage.py createsuperuser</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will be asked to provide a username and a password.</p>
</div>
<div class="paragraph">
<p>To see whether the installation of Django worked run the following command and
see whether the base site loads:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">(venv) ProjectPath/yourproject&gt; python manage.py runserver</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_install_ddm"><a class="anchor" href="#_install_ddm"></a>Install DDM</h3>
<div class="paragraph">
<p>Install the Django DDM package:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">(venv) ProjectPath/yourproject&gt; pip install django-ddm</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, you will have to adjust several sections of your <code>settings.py</code> and <code>urls.py</code> files.</p>
</div>
<div class="sect3">
<h4 id="_update_settings_py"><a class="anchor" href="#_update_settings_py"></a>Update Settings.py</h4>
<div class="paragraph">
<p>First, add the necessary entries to INSTALLED_APPS in your settings.py:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># settings.py

INSTALLED_APPS = [
    # ...,
    'ddm',
    'ckeditor',
    'ckeditor_uploader',
    'webpack_loader',
    'rest_framework',
    'rest_framework.authtoken',
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the following configuration for webpack-loader to your settings.py:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># settings.py

WEBPACK_LOADER = {
    'DEFAULT': {
        'CACHE': True,
        'BUNDLE_DIR_NAME': 'ddm/vue/',
        'STATS_FILE': os.path.join(STATIC_ROOT, 'ddm/vue/webpack-stats.json'),
        'POLL_INTERVAL': 0.1,
        'IGNORE': [r'.+\.hot-update.js', r'.+\.map'],
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the DDM context processor to your template context processors.
This will enable the version indicator of the currently used DDM distribution
below the header in the admin interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># settings.py

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': ['templates'],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                # ...
                'ddm.context_processors.add_ddm_version'  # Add this.
            ],
        },
    },
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configure CKEditor settings in your settings.py to allow your users to upload
images and gifs in instructions and question texts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># settings.py

CKEDITOR_RESTRICT_BY_USER = True  # Files uploaded by one user can only be accessed by this particular user
CKEDITOR_UPLOAD_PATH = 'uploads/'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add time zone support to your settings.py:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># settings.py

USE_TZ = True</code></pre>
</div>
</div>
<div class="paragraph">
<p>Optionally, an e-mail address restriction can be defined in settings.py. Only users whose e-mail address matches the defined regex pattern will be allowed to set up data donation projects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># settings.py

DDM_SETTINGS = {
    'EMAIL_PERMISSION_CHECK':  r'.*(\.|@)somedomain\.com$',
},</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_update_urls_py"><a class="anchor" href="#_update_urls_py"></a>Update urls.py</h4>
<div class="paragraph">
<p>Include the DDM urls in your projects urls.py:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># urls.py

urlpatterns = [
    # ...
    path('ddm/', include('ddm.urls')),
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configure login and logout endpoints for DDM in urls.py:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># urls.py

urlpatterns = [
    ...
    path('ddm/', include('ddm.urls')),
    path('login/', auth_views.LoginView.as_view(template_name='ddm/admin/auth/login.html'), name='ddm-login'),  # You can choose whatever path and template you like
    path('logout/', auth_views.LogoutView.as_view(), name='ddm-logout'),  # You can choose whatever path and template you like
]</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use DDM on a Django site together with <a href="https://wagtail.org/">wagtail</a> and you
have internationalization enabled for your wagtail urls, we recommend to use the
<code>prefix_default_language=False</code> for the i18n_patterns:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># urls.py

urlpatterns += i18n_patterns(
    path('', include(wagtail_urls)),
    prefix_default_language=False
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Not doing this will cause ddm.tests.test_apis.test_participant_deletion_with_regular_login to fail.
In practice, the participant API still seems to work properly despite the test failing, however,
unexpected behaviour cannot be ruled out at this point. This will be fixed in a future version.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Furthermore, add the following to your urls.py:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># urls.py

urlpatterns = [
    ...
    path('ckeditor/', include('ckeditor_uploader.urls')),
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>DDM uses a custom CKEditor toolbar for instruction and question text definitions
that can optionally be customized (<a href="topics/customize_ckeditor_configs.html" class="xref page">find out more</a>)</p>
</div>
</div>
<div class="sect3">
<h4 id="_apply_database_migrations"><a class="anchor" href="#_apply_database_migrations"></a>Apply Database Migrations</h4>
<div class="paragraph">
<p>The Python installation includes SQLite which is configured to be used as a database
backend in the standard <code>settings.py</code> created by Django.
For a development environment, this SQLite is totally fine, however for a production
deployment you should consider configuring a more robust and efficient database such as
PostgreSQL or MariaDB (see the <a href="https://docs.djangoproject.com/en/3.2/topics/install/#get-your-database-running">Django Documentation</a> for further information).</p>
</div>
<div class="paragraph">
<p>Once you have configured a database, run <code>python manage.py migrate</code> to create the ddm models in your database.</p>
</div>
</div>
<div class="sect3">
<h4 id="_test_installation"><a class="anchor" href="#_test_installation"></a>Test Installation</h4>
<div class="paragraph">
<p>To test if your installation was successful, run <code>python manage.py test ddm</code>.
Next, run <code>python manage.py runserver</code> to start the server locally.
Visit <a href="http://127.0.0.1:8000/admin" class="bare">http://127.0.0.1:8000/admin</a> to ensure that the Data Donation Module is listed
as a subsection in the administration interface.</p>
</div>
<div class="paragraph">
<p>Visit <a href="http://127.0.0.1:8000/ddm/projects" class="bare">http://127.0.0.1:8000/ddm/projects</a> to see whether you can access the ddm
project overview site and try to create a new project.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_optional_settings"><a class="anchor" href="#_optional_settings"></a>Optional Settings</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_default_header_images"><a class="anchor" href="#_default_header_images"></a>Default Header Images</h3>
<div class="paragraph">
<p>You can provide default images to be included in the header of the participation views.
These images will be displayed by default, but can be overwritten on a project-basis
by researchers in the project settings.</p>
</div>
<div class="paragraph">
<p>To enable default images, provide the paths to the images that you want to display
in the left and/or right part of the public header in your settings.py as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># settings.py

DDM_DEFAULT_HEADER_IMG_LEFT = '/path/to/logo_left.png'
DDM_DEFAULT_HEADER_IMG_RIGHT = '/path/to/logo_right.png'</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_further_resources"><a class="anchor" href="#_further_resources"></a>Further Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.djangoproject.com/en/3.2/">Official Django Documentation</a></p>
</li>
<li>
<p><a href="https://www.python.org/doc/">Official Python Documentation</a></p>
</li>
<li>
<p>Django Tutorials on <a href="https://www.w3schools.com/django/index.php">W3Schools</a> or <a href="https://www.digitalocean.com/community/tutorials/how-to-install-django-and-set-up-a-development-environment-on-ubuntu-20-04">Digital Ocean</a></p>
</li>
<li>
<p><strong><a href="for_developers.html" class="xref page">Information for developers</a></strong> in this documentation</p>
</li>
</ul>
</div>
</div>
</div>
  <nav class="pagination">
  <span class="prev"><a href="for_researchers.html">For Researchers</a></span>
  <span class="next"><a href="for_developers.html">For Developers</a></span>
</nav>
</article>
  </div>
</main>
<div id="overlay"></div>
</div>
<footer class="footer">
  <div class="footer-content-bite"><a href="https://datadonation.uzh.ch"><img src="../../_/img/DataDonationLab_Logo_Schwarz.svg" height="50px"></a></div>
  <div class="footer-content-bite">© Data Donation Lab, 2023-present</div>
  <div class="footer-content-bite"><a href="https://github.com/uzh/ddm">DDM on GitHub</a></div>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
